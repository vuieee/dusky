This template is the authoritative reference and must be treated as the gold standard. It has been refined over a long period of time and is considered complete, correct, and battle-tested.

Your task is to create a new script derived directly from this template.

Requirements:

Treat the template as the single source of truth.

Perform a thorough, line-by-line analysis of the entire template, including all logic, control flow, comments, assumptions, and documented edge cases.

Fully understand the intent behind every construct before implementing anything.

Reuse and adapt all relevant logic and edge-case handling from the template, applying only what is applicable to the current scenario.

Do not omit safeguards, validations, or design patterns present in the template unless they are demonstrably irrelevant.

Expectations:

Think critically and deliberately at every step.

Ensure the resulting script is intuitive, robust, and production-grade.

Maintain consistency with the structure, philosophy, and behavior established by the template.

The output must meet a very high quality bar, as it will be used by a large user base (700,000+ users).

In short: deeply understand what the template does and why it does it, then faithfully implement all applicable aspects of that behavior in the new script.