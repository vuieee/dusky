## Step 1: Verify prerequisites

Before doing anything:

1. You already have **Matugen** installed and configured (`matugen.toml` exists).
    
2. Make sure your `matugen.toml` contains:
```toml
[templates.neovim]
input_path = '~/.config/matugen/templates/neovim/template.lua'
output_path = '~/.config/matugen/generated/neovim-colors.lua'
post_hook = 'pkill -SIGUSR1 nvim'
```

- Perfect — that means Matugen will generate your Neovim colors file **and** signal Neovim to reload.
    
- Ensure you have **base16-colorscheme** installed for Neovim:

```bash
sudo pacman --needed -S luarocks
```


(OPTIONAL) Then inside Neovim's command panal below:
```bash
:Lazy install RRethy/nvim-base16
```

(Or add it manually, explained in Step 2 (RECOMMANDED).)
## Step 2: Add the base16 plugin

Since you’re using **lazy.nvim**, add it in your plugin config.

Create or open this file:
```bash
nvim ~/.config/nvim/lua/plugins/base16.lua
```

```lua
return {
  "RRethy/nvim-base16",
  lazy = false,
  priority = 1000,
  config = function()
    -- We'll load Matugen colors later, so just keep this ready
  end,
}
```

Then add `"plugins.base16"` to your Lazy import section (only if not already covered by `{ import = "plugins" }` in your `init.lua` or `lua/config/lazy.lua`).

You already have: this so So no changes needed there — Lazy will pick up every Lua file in `lua/plugins`.
```lua
require("lazy").setup({
  spec = {
    { import = "plugins" },
  },
})
```

## Step 3: Create the Matugen template

Create this file (matching your TOML):

```bash
nvim ~/.config/matugen/templates/neovim/template.lua
```

Paste the **exact** template from GitHub:

```lua
-- Auto-generated by Matugen

require('base16-colorscheme').setup({
  base00 = '{{colors.background.default.hex}}',
  base01 = '{{colors.surface_container_lowest.default.hex}}',
  base02 = '{{colors.surface_container_low.default.hex}}',
  base03 = '{{colors.outline_variant.default.hex}}',
  base04 = '{{colors.on_surface_variant.default.hex}}',
  base05 = '{{colors.on_surface.default.hex}}',
  base06 = '{{colors.inverse_on_surface.default.hex}}',
  base07 = '{{colors.surface_bright.default.hex}}',

  base08 = '{{colors.error.default.hex}}',
  base09 = '{{colors.tertiary.default.hex}}',
  base0A = '{{colors.secondary.default.hex}}',
  base0B = '{{colors.primary.default.hex}}',
  base0C = '{{colors.tertiary_container.default.hex}}',
  base0D = '{{colors.primary_container.default.hex}}',
  base0E = '{{colors.secondary_container.default.hex}}',
  base0F = '{{colors.error_container.default.hex}}',
})

-- Extra highlight tuning
local function set_hl_multiple(groups, value)
  for _, v in pairs(groups) do
    vim.api.nvim_set_hl(0, v, value)
  end
end

vim.api.nvim_set_hl(0, 'Visual', {
  bg = '{{colors.primary_container.default.hex}}',
  fg = '{{colors.background.default.hex}}',
})

set_hl_multiple({ 'TSComment', 'Comment' }, {
  fg = '{{colors.on_tertiary_container.default.hex}}',
})

set_hl_multiple({ 'TSMethod', 'Method' }, {
  fg = '{{colors.tertiary.default.hex}}',
})

set_hl_multiple({ 'TSFunction', 'Function' }, {
  fg = '{{colors.secondary.default.hex}}',
})

vim.api.nvim_set_hl(0, 'Keyword', {
  fg = '{{colors.inverse_primary.default.hex}}',
})

vim.api.nvim_set_hl(0, 'MsgArea', {
  bg = '{{colors.surface_container_lowest.default.hex}}',
  fg = '{{colors.primary.default.hex}}',
})
```

Now Matugen will generate `~/.config/matugen/generated/neovim-colors.lua` automatically.

## Step 4: Tell Neovim to load that generated file

We’ll make a **small Lua module** to source the file and auto-reload on signal.

Create:
```bash
nvim ~/.config/nvim/lua/config/matugen.lua
```

Paste this (adapted for your folder structure):

```lua
-- ~/.config/nvim/lua/config/matugen.lua

local M = {}

-- Path to Matugen output
local matugen_path = os.getenv("HOME") .. "/.config/matugen/generated/neovim-colors.lua"

local function source_matugen()
  local file = io.open(matugen_path, "r")
  if not file then
    vim.cmd("colorscheme base16-catppuccin-mocha")
    vim.notify("Matugen colors not found, using fallback theme.", vim.log.levels.WARN)
    return
  end
  io.close(file)
  dofile(matugen_path)
end

local function on_matugen_reload()
  source_matugen()

  -- Reload your lualine theme (important since base16 overwrites)
  dofile(os.getenv("HOME") .. "/.config/nvim/lua/config/lualine-nvim.lua")

  -- Any other post-theme refresh tweaks
  vim.api.nvim_set_hl(0, "Comment", { italic = true })
end

-- Listen for Matugen’s signal
vim.api.nvim_create_autocmd("Signal", {
  pattern = "SIGUSR1",
  callback = on_matugen_reload,
})

-- Initial load
on_matugen_reload()

return M
```


## Step 5: Load it inside your main init

At the **bottom** of your `~/.config/nvim/init.lua` (or anywhere after Lazy setup): VERY IMPORTATANT TO PLACE AFTER LAZY. 

```lua
require("config.matugen")
```

That’s all.  
Neovim will now:

1. Load Matugen colors when starting.
    
2. Automatically reload when `matugen` regenerates the file (via your `post_hook` signal).
    
3. Fall back to a default scheme if not generated yet.